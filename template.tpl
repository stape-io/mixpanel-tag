___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Mixpanel",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Utilizes Mixpanel server API for user and event tracking.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "token",
    "displayName": "Project Token",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "You can get the Project Token from \u003ca href\u003d\"https://mixpanel.com/settings/project\" target\u003d\"_blank\"\u003eproject settings\u003c/a\u003e.",
    "alwaysInSummary": true
  },
  {
    "type": "SELECT",
    "name": "type",
    "displayName": "Tag Type",
    "selectItems": [
      {
        "value": "track",
        "displayValue": "track"
      },
      {
        "value": "alias",
        "displayValue": "alias"
      },
      {
        "value": "reset",
        "displayValue": "reset"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "track"
  },
  {
    "type": "CHECKBOX",
    "name": "serverEU",
    "checkboxText": "Route data to Mixpanel\u0027s EU servers",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "CHECKBOX",
    "name": "identifyAuto",
    "checkboxText": "Automatically handle customer distinct_id",
    "simpleValueType": true,
    "help": "Mixpanel server API optimized for stateless shared usage; e.g., in a web application, the same mixpanel instance is used across requests for all users. Rather than setting a distinct_id through identify() calls like Mixpanel client-side libraries (where a single Mixpanel instance is tied to a single user), this api requires you to pass the distinct_id with every tracking call.",
    "defaultValue": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "reset",
        "type": "NOT_EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identifyCustom",
    "displayName": "Distinct ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "identifyAuto",
        "paramValue": false,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "aliasGroup",
    "displayName": "Alias Options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "alias",
        "displayName": "Alias",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": ""
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "alias",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackGroup",
    "displayName": "Track Options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "trackName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "trackCommonData",
        "checkboxText": "Send common data with request",
        "simpleValueType": true,
        "help": "Adds to track request user_agent, path, $current_url, $screen_width, $screen_height, $referrer, user ip, etc.",
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "trackFromVariable",
        "checkboxText": "Get parameters from variable",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "trackParameters",
        "displayName": "Parameters (Optional)",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "trackFromVariable",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "trackParametersObject",
        "displayName": "Parameters object",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "trackFromVariable",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getAllEventData = require('getAllEventData');
const JSON = require('JSON');
const sendHttpRequest = require('sendHttpRequest');
const getTimestampMillis = require('getTimestampMillis');
const setCookie = require('setCookie');
const getCookieValues = require('getCookieValues');
const getContainerVersion = require('getContainerVersion');
const logToConsole = require('logToConsole');
const getRequestHeader = require('getRequestHeader');
const generateRandom = require('generateRandom');
const parseUrl = require('parseUrl');
const makeString = require('makeString');

const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;
const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');

const eventData = getAllEventData();
let cookieOptions = {
    domain: 'auto',
    path: '/',
    samesite: 'Lax',
    secure: true,
    'max-age': 31536000, // 1 year
    httpOnly: false
};

if (data.type === 'track') {
    sendTrackRequest();
} else if (data.type === 'alias') {
    sendAliasRequest();
} else if (data.type === 'reset') {
    cookieOptions['max-age'] = 1;

    setCookie('stape_mixpanel_distinct_id', 'empty', cookieOptions);
    setCookie('stape_mixpanel_device_id', 'empty', cookieOptions);
    data.gtmOnSuccess();

    return;
}

function sendTrackRequest() {
    let postBody = {
        properties: {}
    };

    if (data.trackCommonData) {
        postBody = trackCommonData(postBody);
    }

    if (!data.trackFromVariable && data.trackParameters) {
        data.trackParameters.forEach(d => {
            postBody.properties[d.name] = d.value;
        });
    }

    if (data.trackFromVariable && data.trackParametersObject) {
        for (let key in data.trackParametersObject) {
            postBody.properties[key] = data.trackParametersObject[key];
        }
    }

    sendRequest(data.trackName, postBody);
}

function sendAliasRequest() {
    sendRequest('$create_alias', {
        properties: {
            alias: data.alias
        }
    });
}

function sendRequest(eventName, postBody) {
    postBody.event = eventName;

    if (!postBody.properties) postBody.properties = {};
    postBody.properties.token = data.token;
    postBody.properties.distinct_id = getDistinctId();
    postBody.properties['$device_id'] = getDeviceId(postBody.properties.distinct_id);

    if (data.identifyAuto) setDistinctIdCookies(postBody.properties.distinct_id, postBody.properties['$device_id']);

    const postUrl = 'https://' + (data.serverEU ? 'api-eu.mixpanel.com' : 'api.mixpanel.com') + '/track?verbose=1';
    postBody = [postBody];

    if (isLoggingEnabled) {
        logToConsole(JSON.stringify({
            'Name': 'Mixpanel',
            'Type': 'Request',
            'TraceId': traceId,
            'EventName': eventName,
            'RequestMethod': 'POST',
            'RequestUrl': postUrl,
            'RequestBody': postBody,
        }));
    }

    sendHttpRequest(postUrl, (statusCode, headers, body) => {
        if (isLoggingEnabled) {
            logToConsole(JSON.stringify({
                'Name': 'Mixpanel',
                'Type': 'Response',
                'TraceId': traceId,
                'EventName': eventName,
                'ResponseStatusCode': statusCode,
                'ResponseHeaders': headers,
                'ResponseBody': body,
            }));
        }

        if (statusCode >= 200 && statusCode < 400) {
            data.gtmOnSuccess();
        } else {
            data.gtmOnFailure();
        }
    }, {headers: {'Content-Type': 'application/json'}, method: 'POST'}, JSON.stringify(postBody));
}

function getDistinctId() {
    if (!data.identifyAuto) return data.identifyCustom;

    let mpData = getCookieValues('mp_' + data.token + '_mixpanel')[0];
    if (mpData) return JSON.parse(mpData).distinct_id;

    let distinctIdCookie = getCookieValues('stape_mixpanel_distinct_id')[0];
    if (distinctIdCookie) return distinctIdCookie;

    return 's-' + getTimestampMillis() + '-' + generateRandom(100000, 999999) + '-' + generateRandom(100000, 999999);
}

function getDeviceId(distinctId) {
    if (!data.identifyAuto) return data.identifyCustom;

    let mpData = getCookieValues('mp_' + data.token + '_mixpanel')[0];
    if (mpData) return JSON.parse(mpData)['$device_id'];

    let distinctIdCookie = getCookieValues('stape_mixpanel_device_id')[0];
    if (distinctIdCookie) return distinctIdCookie;

    return distinctId;
}

function setDistinctIdCookies(distinctId, deviceId) {
    setCookie('stape_mixpanel_distinct_id', makeString(distinctId), cookieOptions);
    setCookie('stape_mixpanel_device_id', makeString(deviceId), cookieOptions);
}

function trackCommonData(postBody) {
    postBody = {
        properties: {
            'ip': eventData.ip_override || eventData.ip,
            'mp_lib': 'stape',
            '$lib_version': '1.0.0',
        }
    };

    if (eventData.user_agent) postBody.properties.user_agent = eventData.user_agent;
    if (eventData.page_path) postBody.properties.path = eventData.page_path;
    if (eventData.page_location) postBody.properties['$current_url'] = eventData.page_location;
    if (eventData.screen_resolution) postBody.properties['$screen_width'] = eventData.screen_resolution.split('x')[0];
    if (eventData.screen_resolution) postBody.properties['$screen_height'] = eventData.screen_resolution.split('x')[1];
    if (eventData.page_referrer) postBody.properties['$referrer'] = eventData.page_referrer;
    if (eventData.page_referrer) postBody.properties['$referring_domain'] = parseUrl(eventData.page_referrer).hostname;

    const url = eventData.page_location || getRequestHeader('referer');
    const urlParsed = parseUrl(url);

    if (urlParsed && urlParsed.searchParams.utm_medium) postBody.properties['$utm_medium'] = urlParsed.searchParams.utm_medium;
    if (urlParsed && urlParsed.searchParams.utm_source) postBody.properties['$utm_source'] = urlParsed.searchParams.utm_source;
    if (urlParsed && urlParsed.searchParams.utm_campaign) postBody.properties['$utm_campaign'] = urlParsed.searchParams.utm_campaign;
    if (urlParsed && urlParsed.searchParams.utm_content) postBody.properties['$utm_content'] = urlParsed.searchParams.utm_content;

    if (postBody.properties['$referrer']) {
        let searchEngine = getSearchEngine(postBody.properties['$referrer']);

        if (searchEngine) {
            let searchEngineKeyword = null;

            if (urlParsed) {
                searchEngineKeyword = searchEngine !== 'yahoo' ? urlParsed.searchParams.q : urlParsed.searchParams.p;
            }

            postBody.properties['$search_engine'] = searchEngine;
            if (searchEngineKeyword) postBody.properties['mp_keyword'] = searchEngineKeyword;
        }
    }

    if (postBody.properties.user_agent) {
        let os = getOS(postBody.properties.user_agent);
        let device = getDevice(postBody.properties.user_agent);
        let browser = getBrowser(postBody.properties.user_agent);

        if (os) postBody.properties['$os'] = os;
        if (device) postBody.properties['$device'] = device;
        if (browser) postBody.properties['$browser'] = browser;
    }

    let initialReferrer = getCookieValues('stape_mixpanel_initial_referrer')[0];
    if (initialReferrer) postBody.properties['$initial_referrer'] = initialReferrer;
    if (!initialReferrer) {
        postBody.properties['$initial_referrer'] = postBody.properties['$referrer'] ? postBody.properties['$referrer'] : 'direct';
        setCookie('stape_mixpanel_initial_referrer', makeString(postBody.properties['$initial_referrer']), cookieOptions);
    }

    if (postBody.properties['$initial_referrer'] && postBody.properties['$initial_referrer'] !== 'direct') postBody.properties['$initial_referring_domain'] = parseUrl(postBody.properties['$initial_referrer']).hostname;

    return postBody;
}

function getOS(user_agent) {
    if (user_agent.toLowerCase().match('windows') && user_agent.match('Phone')) return 'Windows Mobile';
    else if (user_agent.toLowerCase().match('windows')) return 'Windows';
    else if (user_agent.match('(iPhone|iPad|iPod)')) return 'iOS';
    else if (user_agent.match('Android')) return 'Android';
    else if (user_agent.match('(BlackBerry|PlayBook|BB10)')) return 'BlackBerry';
    else if (user_agent.match('Mac')) return 'Mac OS X';
    else if (user_agent.match('Linux')) return 'Linux';

    return '';
}

function getDevice(user_agent) {
    if (user_agent.match('iPad')) return 'iPad';
    else if (user_agent.match('iPod')) return 'iPod Touch';
    else if (user_agent.match('iPhone')) return 'iPhone';
    else if (user_agent.toLowerCase().match('(blackberry|playbook|bb10)')) return 'BlackBerry';
    else if (user_agent.toLowerCase().match('windows phone')) return 'Windows Phone';
    else if (user_agent.match('Android')) return 'Android';

    return '';
}

function getBrowser(user_agent) {
    if (user_agent.match('Opera Mini')) return 'Opera Mini';
    if (user_agent.match('Opera')) return 'Opera';
    if (user_agent.toLowerCase().match('(BlackBerry|PlayBook|BB10)')) return 'BlackBerry';
    if (user_agent.match('FBIOS')) return 'Facebook Mobile';
    if (user_agent.match('Chrome')) return 'Chrome';
    if (user_agent.match('CriOS')) return 'Chrome iOS';
    if (user_agent.match('Apple') && user_agent.match('Mobile')) return 'Mobile Safari';
    if (user_agent.match('Apple')) return 'Safari';
    if (user_agent.match('Android')) return 'Android Mobile';
    if (user_agent.match('Konqueror')) return 'Konqueror';
    if (user_agent.match('Firefox')) return 'Firefox';
    if (user_agent.match('MSIE') || user_agent.match('Trident')) return 'Internet Explorer';
    if (user_agent.match('Gecko')) return 'Mozilla';

    return '';
}

function getSearchEngine(referrer) {
    if (referrer.search('https?://(.*)google.([^/?]*)') === 0) return 'google';
    else if (referrer.search('https?://(.*)bing.com') === 0) return 'bing';
    else if (referrer.search('https?://(.*)yahoo.com') === 0) return 'yahoo';
    else if (referrer.search('https?://(.*)duckduckgo.com') === 0) return 'duckduckgo';

    return null;
}

function determinateIsLoggingEnabled() {
    if (!data.logType) {
        return isDebug;
    }

    if (data.logType === 'no') {
        return false;
    }

    if (data.logType === 'debug') {
        return isDebug;
    }

    return data.logType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "referrer"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "stape_mixpanel_distinct_id"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "stape_mixpanel_device_id"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "stape_mixpanel_initial_referrer"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://api.mixpanel.com/*"
              },
              {
                "type": 1,
                "string": "https://api-eu.mixpanel.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 15/06/2022, 17:43:17


